use crate::{collision::obj_collision, animation::Animations, TILE_SIZE};
use bevy::prelude::*;
use benimator::*;

pub struct CoinPlugin;

#[derive(Component)]
pub struct Coin;


impl Plugin for CoinPlugin{
    fn build(&self, app: &mut App){
	app.add_system(obj_collision)
	    .add_system_to_stage(CoreStage::PostUpdate, no_bodies);
    }
}

fn no_bodies
    (
	query: Query<(), With<Coin>>,
	removed: RemovedComponents<Coin>,
	mut commands: Commands,
	animations: Res<Animations>,
	assets: Res<AssetServer>,
	mut texture: ResMut<Assets<TextureAtlas>>,
	
 )
{
    if removed.iter().next().is_some() {
        if query.is_empty() {
            commands.spawn_bundle(SpriteSheetBundle
				  {
				      texture_atlas: texture.add(TextureAtlas::from_grid(
					  assets.load("you-win-sheet.png"),
					  Vec2::new(16.0, 16.0),
					  2,
					  2,
				      )),
				      transform: Transform
				      {
					  translation: Vec3::new(0.0, 0.0, 900.0),
					  scale: Vec3::splat(TILE_SIZE/7 as f32),
					  ..Default::default()
				      },
				      ..Default::default()
				  })
		.insert(animations.slow.clone())
		.insert(Play)
		.insert(Timer::from_seconds(5.0, true));
		
        }
    }
}
